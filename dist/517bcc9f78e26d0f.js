import"./style.css";function delAllLowTiles(){let e=window.game.getAllLowTiles(),t=[];e.forEach((e=>{window.game.board[e.x][e.y].tilesArray.pop(),document.querySelectorAll(`[data-x="${25*e.x}"]`).forEach((o=>{o.getAttribute("data-y")===""+25*e.y&&t.push(o)}))})),t.forEach((e=>{e.remove()})),window.game.initTile()}let btnNew=document.querySelector(".popup__body--btn__new");btnNew.onclick=()=>{tgames.showRewardedAd("default",5,1),gameStart(),tgames.gameStarted()};let btnShare=document.querySelector(".popup__body--btn__share");btnShare.onclick=()=>{tgames.share()};let btnRestart=document.querySelector(".popup__body--btn__restart");btnRestart.onclick=()=>{tgames.gameOver(game.score),tgames.showRewardedAd("default",5,1),gameStart(),tgames.gameStarted()};let btnStart=document.querySelector(".popup__body--btn__start");btnStart.onclick=()=>{gameStart(),tgames.gameStarted(),document.querySelector(".popup__start").style.display="none"};let btnSkip=document.querySelector(".popup__body--btn__skip");btnSkip.onclick=()=>{window.game.endGame()};let btnContinue=document.querySelector(".popup__body--btn__continue");function gameStart(){window.game=new Game(4),window.game.initialize();let e=document.querySelector(".popup");console.log(e),e.style.display="none",document.querySelector(".popup__continue").style.display="none"}function Game(e){this.rows=e,this.columns=e,this.board=[],this.boardFlatten=function(){return _.flatten(this.board)},this.score=0,$('[data-js="score"]').html(this.score.toString()),this.moveInProgress=!1}function getRandomInt(e){return Math.floor(Math.random()*e)}function Tile(e,t,o){this.game=o,this.el,this.x=e,this.y=t,4===getRandomInt(10)?this.valueProp=4:this.valueProp=2,Object.defineProperties(this,{value:{get:function(){return this.valueProp},set:function(e){this.valueProp=e,this.el.find(".tile_number").html(this.valueProp).attr("data-value",e)}}}),this.canMove=!1,this.initialize()}btnContinue.onclick=()=>{tgames.showRewardedAd("default",15,2),delAllLowTiles(),clearTimeout(window.game.adsTimeout),document.querySelector(".popup__continue").style.display="none"},$(document).ready(gameStart),Game.prototype.initialize=function(){$(".grid").empty(),$(".tile-container").empty(),this.initBoard(),this.initTile(),this.initEventListeners()},Game.prototype.initBoard=function(){function e(e,t){var o=$.parseHTML($("#template_grid_cell").html());return $(o).appendTo(".grid"),{x:e,y:t,tilesArray:[]}}for(var t=0;t<this.rows;t++){this.board.push([]);for(var o=0;o<this.columns;o++){var i=e(t,o);this.board[t].push(i)}}},Game.prototype.initTile=function(){this.isGameOver();var e=this.getRandomEmptyCell();new Tile(e.x,e.y,game),this.isGameOver()},Game.prototype.initEventListeners=function(){var e=this,t=document.getElementById("touchGameboard");window.hammertime&&window.hammertime.destroy(),window.hammertime=new Hammer(t,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_ALL}]]}),window.hammertime.on("swipeleft",(function(t){e.move("left")})).on("swiperight",(function(t){e.move("right")})).on("swipedown",(function(t){e.move("down")})).on("swipeup",(function(t){e.move("up")})),$(document).off("keydown.move").on("keydown.move",(function(t){switch(t.preventDefault(),t.which){case 37:e.move("left");break;case 38:e.move("up");break;case 39:e.move("right");break;case 40:e.move("down")}})),$('[data-js="newGame"]').off("click.newGame").on("click.newGame",window.gameStart)},Game.prototype.gameWon=function(){let e=document.getElementsByClassName("tile");for(;e.length>0;)e[0].parentNode.removeChild(e[0]);document.querySelector(".popup").style.display="flex",alert("you won"),tgames.gameOver(game.score)},Game.prototype.getMaxTile=function(){let e=this.boardFlatten(),t=-1/0;return e.forEach((e=>{0!==e.tilesArray.length&&e.tilesArray[0].valueProp>t&&(t=e.tilesArray[0].valueProp)})),t},Game.prototype.createBlock=function(e){let t=document.querySelector(".info__tile--block"),o=document.createElement("div");o.className="tile",o.innerHTML=`<span class="tile_number" data-value=${e}>${e}</span>`,t.appendChild(o)},Game.prototype.endGame=function(){let e=document.querySelector(".popup__restart");document.querySelector(".popup__continue").style.display="none",e.style.display="flex";let t=this.getMaxTile(),o=document.getElementsByClassName("tile");for(;o.length>0;)o[0].parentNode.removeChild(o[0]);this.createBlock(t),document.querySelector(".info__score--value").innerHTML=`${this.score}`,tgames.gameOver(game.score),clearTimeout(this.adsTimeout)},Game.prototype.gameLost=function(){document.querySelector(".popup__continue").style.display="flex",this.adsTimeout=setTimeout((()=>{this.endGame()}),8e3)},Game.prototype.isGameOver=function(){var e=this.boardFlatten(),t=!1,o=!1,i=!1;return e.forEach((function(e,o,i){e.tilesArray.forEach((function(e,o,i){131072===e.valueProp&&(t=!0)}))})),this.getEmptyCells().length>0&&(i=!0),e.forEach((function(e,t,i){e.tilesArray.forEach((function(e,t,i){e.moveCheck(),!0===e.canMove&&(o=!0)}))})),t?(this.gameWon(),!0):!i&&!o&&(this.gameLost(),!0)},Game.prototype.getEmptyCells=function(){return _.filter(this.boardFlatten(),(function(e){return!e.tilesArray.length}))},Game.prototype.getRandomEmptyCell=function(){var e=this.getEmptyCells();return e[Math.floor(Math.random()*Math.floor(e.length))]},Game.prototype.getAllLowTiles=function(){let e=this.boardFlatten(),t=[];return e.forEach((e=>{0!==e.tilesArray.length&&2===e.tilesArray[0].valueProp&&t.push({x:e.tilesArray[0].x,y:e.tilesArray[0].y})})),t},Game.prototype.TileMerge=function(){var e=this.boardFlatten(),t=this.score;e.forEach((function(e,o,i){if(2===e.tilesArray.length){var r=e.tilesArray[0].valueProp;e.tilesArray[0].value=2*r,e.tilesArray.pop().el.remove(),t+=r,tgames.setScore(t)}})),this.score=t,$('[data-js="score"]').html(this.score.toString())},Game.prototype.moveAnimations=function(e){var t=this,o=[];if(this.moveInProgress)return!1;this.moveInProgress=!0,e.forEach((function(e,t,i){e.tilesArray.forEach((function(e,t,i){o.push(e.animatePosition())}))})),$.when.apply($,o).then((function(){t.moveInProgress=!1,t.TileMerge(),t.initTile()})),0===o.length&&(t.moveInProgress=!1,t.TileMerge(),t.initTile())},Game.prototype.move=function(e){var t,o=e.toLowerCase(),i=!1;if(this.moveInProgress)return!1;"up"===o?t=_.orderBy(this.boardFlatten(),"y","asc"):"right"===o?t=_.orderBy(this.boardFlatten(),"x","desc"):"down"===o?t=_.orderBy(this.boardFlatten(),"y","desc"):"left"===o&&(t=_.orderBy(this.boardFlatten(),"y","asc")),t.forEach((function(e,t,r){e.tilesArray.length&&e.tilesArray.forEach((function(e){e.move(o,!0)&&(i=!0,e.move(o))}))})),i&&this.moveAnimations(t)},Tile.prototype.initialize=function(){var e=$.parseHTML($("#template_tile").html());this.el=$(e),this.el.find(".tile_number").html(this.valueProp).attr("data-value",this.valueProp),this.setPosition(this.x,this.y),this.animatePosition(!0),this.el.appendTo(".tile-container")},Tile.prototype.setPosition=function(e,t){this.x=e,this.y=t,this.game.board[e][t].tilesArray.push(this)},Tile.prototype.removeOldPosition=function(e,t){this.game.board[e][t].tilesArray.pop()},Tile.prototype.animatePosition=function(e){var t=this,o=this.x*(100/this.game.rows),i=this.y*(100/this.game.columns),r=$.Deferred();function n(){r.resolve(),t.el.removeClass("animate"),t.el.removeClass("initialize")}function a(){t.el.addClass("animate"),t.el.attr({"data-x":o,"data-y":i})}return e?this.el.addClass("initialize"):this.el.removeClass("initialize"),e?(a(),window.setTimeout(n,225)):(a(),window.setTimeout(n,175)),r},Tile.prototype.moveCheck=function(){return this.move("up",!0)||this.move("right",!0)||this.move("down",!0)||this.move("left",!0)?(this.canMove=!0,!0):(this.canMove=!1,!1)},Tile.prototype.move=function(e,t){t=!!t;var o,i,r,n=e.toLowerCase(),a=this.x,s=this.y,l=[];if("up"===n?(o=this.y>0&&this.game.board[this.x][this.y-1],l.push(this.x,this.y-1)):"right"===n?(o=this.x<3&&this.game.board[this.x+1][this.y],l.push(this.x+1,this.y)):"down"===n?(o=this.y<3&&this.game.board[this.x][this.y+1],l.push(this.x,this.y+1)):"left"===n&&(o=this.x>0&&this.game.board[this.x-1][this.y],l.push(this.x-1,this.y)),i=o&&1===o.tilesArray.length&&o.tilesArray[0].valueProp===this.valueProp,r=o&&0===o.tilesArray.length,t)return!(!r&&!i);(r||i)&&(this.setPosition(l[0],l[1]),this.removeOldPosition(a,s),i||this.move(n))};