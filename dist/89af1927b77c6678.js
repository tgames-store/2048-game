import"./style.css";let btnNew=document.querySelector(".popup__body--btn__new");btnNew.onclick=()=>{tgames.showRewardedAd(),gameStart(),tgames.gameStarted()};let btnShare=document.querySelector(".popup__body--btn__share");btnShare.onclick=()=>{tgames.share()};let btnRestart=document.querySelector(".popup__body--btn__restart");btnRestart.onclick=()=>{tgames.gameOver(game.score),tgames.showRewardedAd(),gameStart(),tgames.gameStarted()};let btnStart=document.querySelector(".popup__body--btn__start");function gameStart(){window.game=new Game(4),window.game.initialize(),document.querySelector(".popup").style.display="none"}function Game(t){this.rows=t,this.columns=t,this.board=[],this.boardFlatten=function(){return _.flatten(this.board)},this.score=0,$('[data-js="score"]').html(this.score.toString()),this.moveInProgress=!1}function getRandomInt(t){return Math.floor(Math.random()*t)}function Tile(t,e,i){this.game=i,this.el,this.x=t,this.y=e,4===getRandomInt(10)?this.valueProp=4:this.valueProp=2,Object.defineProperties(this,{value:{get:function(){return this.valueProp},set:function(t){this.valueProp=t,this.el.find(".tile_number").html(this.valueProp).attr("data-value",t)}}}),this.canMove=!1,this.initialize()}btnStart.onclick=()=>{gameStart(),tgames.gameStarted(),document.querySelector(".popup__start").style.display="none"},$(document).ready(gameStart),Game.prototype.initialize=function(){$(".grid").empty(),$(".tile-container").empty(),this.initBoard(),this.initTile(),this.initEventListeners()},Game.prototype.initBoard=function(){function t(t,e){var i=$.parseHTML($("#template_grid_cell").html());return $(i).appendTo(".grid"),{x:t,y:e,tilesArray:[]}}for(var e=0;e<this.rows;e++){this.board.push([]);for(var i=0;i<this.columns;i++){var o=t(e,i);this.board[e].push(o)}}},Game.prototype.initTile=function(){this.isGameOver();var t=this.getRandomEmptyCell();new Tile(t.x,t.y,game),this.isGameOver()},Game.prototype.initEventListeners=function(){var t=this,e=document.getElementById("touchGameboard");window.hammertime&&window.hammertime.destroy(),window.hammertime=new Hammer(e,{recognizers:[[Hammer.Swipe,{direction:Hammer.DIRECTION_ALL}]]}),window.hammertime.on("swipeleft",(function(e){t.move("left")})).on("swiperight",(function(e){t.move("right")})).on("swipedown",(function(e){t.move("down")})).on("swipeup",(function(e){t.move("up")})),$(document).off("keydown.move").on("keydown.move",(function(e){switch(e.preventDefault(),e.which){case 37:t.move("left");break;case 38:t.move("up");break;case 39:t.move("right");break;case 40:t.move("down")}})),$('[data-js="newGame"]').off("click.newGame").on("click.newGame",window.gameStart)},Game.prototype.gameWon=function(){let t=document.getElementsByClassName("tile");for(;t.length>0;)t[0].parentNode.removeChild(t[0]);document.querySelector(".popup").style.display="flex",alert("you won"),tgames.gameOver(game.score)},Game.prototype.gameLost=function(){let t=document.getElementsByClassName("tile");for(;t.length>0;)t[0].parentNode.removeChild(t[0]);document.querySelector(".popup").style.display="flex",tgames.gameOver(game.score),alert("What a loser?!")},Game.prototype.isGameOver=function(){var t=this.boardFlatten(),e=!1,i=!1,o=!1;return t.forEach((function(t,i,o){t.tilesArray.forEach((function(t,i,o){131072===t.valueProp&&(e=!0)}))})),this.getEmptyCells().length>0&&(o=!0),t.forEach((function(t,e,o){t.tilesArray.forEach((function(t,e,o){t.moveCheck(),!0===t.canMove&&(i=!0)}))})),e?(this.gameWon(),!0):!o&&!i&&(this.gameLost(),!0)},Game.prototype.getEmptyCells=function(){return _.filter(this.boardFlatten(),(function(t){return!t.tilesArray.length}))},Game.prototype.getRandomEmptyCell=function(){var t=this.getEmptyCells();return t[Math.floor(Math.random()*Math.floor(t.length))]},Game.prototype.TileMerge=function(){var t=this.boardFlatten(),e=this.score;t.forEach((function(t,i,o){if(2===t.tilesArray.length){var r=t.tilesArray[0].valueProp;t.tilesArray[0].value=2*r,t.tilesArray.pop().el.remove(),e+=r,tgames.setScore(e)}})),this.score=e,$('[data-js="score"]').html(this.score.toString())},Game.prototype.moveAnimations=function(t){var e=this,i=[];if(this.moveInProgress)return!1;this.moveInProgress=!0,t.forEach((function(t,e,o){t.tilesArray.forEach((function(t,e,o){i.push(t.animatePosition())}))})),$.when.apply($,i).then((function(){e.moveInProgress=!1,e.TileMerge(),e.initTile()})),0===i.length&&(e.moveInProgress=!1,e.TileMerge(),e.initTile())},Game.prototype.move=function(t){var e,i=t.toLowerCase(),o=!1;if(this.moveInProgress)return!1;"up"===i?e=_.orderBy(this.boardFlatten(),"y","asc"):"right"===i?e=_.orderBy(this.boardFlatten(),"x","desc"):"down"===i?e=_.orderBy(this.boardFlatten(),"y","desc"):"left"===i&&(e=_.orderBy(this.boardFlatten(),"y","asc")),e.forEach((function(t,e,r){t.tilesArray.length&&t.tilesArray.forEach((function(t){t.move(i,!0)&&(o=!0,t.move(i))}))})),o&&this.moveAnimations(e)},Tile.prototype.initialize=function(){var t=$.parseHTML($("#template_tile").html());this.el=$(t),this.el.find(".tile_number").html(this.valueProp).attr("data-value",this.valueProp),this.setPosition(this.x,this.y),this.animatePosition(!0),this.el.appendTo(".tile-container")},Tile.prototype.setPosition=function(t,e){this.x=t,this.y=e,this.game.board[t][e].tilesArray.push(this)},Tile.prototype.removeOldPosition=function(t,e){this.game.board[t][e].tilesArray.pop()},Tile.prototype.animatePosition=function(t){var e=this,i=this.x*(100/this.game.rows),o=this.y*(100/this.game.columns),r=$.Deferred();function a(){r.resolve(),e.el.removeClass("animate"),e.el.removeClass("initialize")}function n(){e.el.addClass("animate"),e.el.attr({"data-x":i,"data-y":o})}return t?this.el.addClass("initialize"):this.el.removeClass("initialize"),t?(n(),window.setTimeout(a,225)):(n(),window.setTimeout(a,175)),r},Tile.prototype.moveCheck=function(){return this.move("up",!0)||this.move("right",!0)||this.move("down",!0)||this.move("left",!0)?(this.canMove=!0,!0):(this.canMove=!1,!1)},Tile.prototype.move=function(t,e){e=!!e;var i,o,r,a=t.toLowerCase(),n=this.x,s=this.y,l=[];if("up"===a?(i=this.y>0&&this.game.board[this.x][this.y-1],l.push(this.x,this.y-1)):"right"===a?(i=this.x<3&&this.game.board[this.x+1][this.y],l.push(this.x+1,this.y)):"down"===a?(i=this.y<3&&this.game.board[this.x][this.y+1],l.push(this.x,this.y+1)):"left"===a&&(i=this.x>0&&this.game.board[this.x-1][this.y],l.push(this.x-1,this.y)),o=i&&1===i.tilesArray.length&&i.tilesArray[0].valueProp===this.valueProp,r=i&&0===i.tilesArray.length,e)return!(!r&&!o);(r||o)&&(this.setPosition(l[0],l[1]),this.removeOldPosition(n,s),o||this.move(a))};